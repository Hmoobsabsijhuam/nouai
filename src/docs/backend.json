{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the SecureLogin application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "displayName": {
          "type": "string",
          "description": "The user's display name."
        },
        "photoURL": {
          "type": "string",
          "description": "The URL of the user's profile picture.",
          "format": "uri"
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp when the user was created."
        },
        "dateOfBirth": {
          "type": "string",
          "format": "date",
          "description": "The user's date of birth."
        },
        "status": {
          "type": "string",
          "description": "The user's marital status.",
          "enum": [
            "Single",
            "Married"
          ]
        },
        "country": {
          "type": "string",
          "description": "The user's country of residence."
        },
        "credits": {
            "type": "number",
            "description": "The number of credits the user has."
        }
      },
      "required": [
        "id",
        "email"
      ]
    },
    "Admin": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Admin",
      "type": "object",
      "description": "Stores the emails of administrators",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the admin entity."
        },
        "email": {
          "type": "string",
          "description": "The email of the admin.",
          "format": "email"
        }
      },
      "required": [
        "id",
        "email"
      ]
    },
    "Notification": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Notification",
      "type": "object",
      "description": "Represents a global notification sent by an admin.",
      "properties": {
        "message": {
          "type": "string",
          "description": "The content of the notification."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp when the notification was created."
        }
      },
      "required": [
        "message",
        "createdAt"
      ]
    },
    "UserNotification": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User Notification",
      "type": "object",
      "description": "Represents a user-specific notification, tracking read status.",
      "properties": {
        "message": {
          "type": "string",
          "description": "The content of the notification."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp when the notification was created."
        },
        "read": {
          "type": "boolean",
          "description": "Indicates if the notification has been read by the user."
        },
        "globalNotificationId": {
            "type": "string",
            "description": "The ID of the original global notification."
        }
      },
      "required": [
        "message",
        "createdAt",
        "read"
      ]
    },
    "GeneratedImage": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Generated Image",
      "type": "object",
      "description": "Represents an image generated by a user.",
      "properties": {
        "prompt": {
          "type": "string",
          "description": "The text prompt used to generate the image."
        },
        "imageUrl": {
          "type": "string",
          "format": "uri",
          "description": "The URL of the generated image in Firebase Storage."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp when the image was generated."
        },
        "isPublic": {
          "type": "boolean",
          "description": "Whether the image is visible to the public."
        }
      },
      "required": [
        "prompt",
        "imageUrl",
        "createdAt"
      ]
    },
    "PublicImage": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Public Image",
      "type": "object",
      "description": "Represents an image that has been made public by a user.",
      "properties": {
        "prompt": {
          "type": "string",
          "description": "The text prompt used to generate the image."
        },
        "imageUrl": {
          "type": "string",
          "format": "uri",
          "description": "The URL of the generated image."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp when the image was generated."
        },
        "authorId": {
          "type": "string",
          "description": "The ID of the user who created the image."
        },
        "authorName": {
          "type": "string",
          "description": "The display name of the user who created the image."
        },
        "authorPhotoUrl": {
          "type": "string",
          "format": "uri",
          "description": "The profile picture URL of the user who created the image."
        }
      },
      "required": [
        "prompt",
        "imageUrl",
        "createdAt",
        "authorId",
        "authorName"
      ]
    },
    "GeneratedVideo": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Generated Video",
      "type": "object",
      "description": "Represents a video generated by a user.",
      "properties": {
        "prompt": {
          "type": "string",
          "description": "The text prompt used to generate the video."
        },
        "videoUrl": {
          "type": "string",
          "format": "uri",
          "description": "The URL of the generated video in Firebase Storage."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp when the video was generated."
        }
      },
      "required": [
        "prompt",
        "videoUrl",
        "createdAt"
      ]
    },
    "SupportTicket": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Support Ticket",
      "type": "object",
      "description": "Represents a support ticket submitted by a user.",
      "properties": {
        "userId": {
          "type": "string",
          "description": "The ID of the user who submitted the ticket."
        },
        "userEmail": {
          "type": "string",
          "description": "The email of the user for easy reference.",
          "format": "email"
        },
        "subject": {
          "type": "string",
          "description": "The subject of the support ticket."
        },
        "message": {
          "type": "string",
          "description": "The detailed message of the support ticket."
        },
        "status": {
          "type": "string",
          "description": "The current status of the support ticket.",
          "enum": ["open", "closed"]
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp when the ticket was created."
        },
        "updatedAt": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp when the ticket was last updated."
        }
      },
      "required": [
        "userId",
        "userEmail",
        "subject",
        "message",
        "status",
        "createdAt",
        "updatedAt"
      ]
    },
    "AdminNotification": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Admin Notification",
      "type": "object",
      "description": "Represents a notification for administrators, such as a credit purchase.",
      "properties": {
        "userId": {
          "type": "string",
          "description": "The ID of the user related to the notification."
        },
        "userEmail": {
          "type": "string",
          "description": "The email of the user for easy reference."
        },
        "message": {
          "type": "string",
          "description": "The content of the notification message."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp when the notification was created."
        },
        "read": {
            "type": "boolean",
            "description": "Whether the admin has marked this notification as read."
        },
        "link": {
            "type": "string",
            "format": "uri",
            "description": "A relevant link, e.g., to the user's profile."
        },
        "paymentStatus": {
          "type": "string",
          "description": "The status of the payment for the credit purchase.",
          "enum": ["pending", "paid", "rejected"]
        }
      },
      "required": [
        "userId",
        "userEmail",
        "message",
        "createdAt",
        "read",
        "paymentStatus"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Uses path-based ownership for private user data, ensuring that only the authenticated user can access their profile.",
          "subcollections": [
            {
              "path": "user_notifications/{notificationId}",
              "definition": {
                "entityName": "UserNotification",
                "schema": {
                  "$ref": "#/backend/entities/UserNotification"
                },
                "description": "Stores notifications specific to a user, including their read status."
              }
            },
            {
              "path": "generated_images/{imageId}",
              "definition": {
                "entityName": "GeneratedImage",
                "schema": {
                  "$ref": "#/backend/entities/GeneratedImage"
                },
                "description": "Stores images generated by a user."
              }
            },
            {
              "path": "generated_videos/{videoId}",
              "definition": {
                "entityName": "GeneratedVideo",
                "schema": {
                  "$ref": "#/backend/entities/GeneratedVideo"
                },
                "description": "Stores videos generated by a user."
              }
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "entityName": "Admin",
          "schema": {
            "$ref": "#/backend/entities/Admin"
          },
          "description": "This collection stores admin role assignments. The existence of a document with the user's UID indicates that the user has admin privileges. This supports secure list operations (QAPs) by allowing rules to check for the existence of this document without needing to filter based on its contents."
        }
      },
      {
        "path": "/notifications/{notificationId}",
        "definition": {
          "entityName": "Notification",
          "schema": {
            "$ref": "#/backend/entities/Notification"
          },
          "description": "Stores global notifications sent by the admin. These are fanned out to individual user notification subcollections."
        }
      },
       {
        "path": "/admin_notifications/{notificationId}",
        "definition": {
          "entityName": "AdminNotification",
          "schema": {
            "$ref": "#/backend/entities/AdminNotification"
          },
          "description": "Stores notifications intended for administrators, such as credit purchase alerts."
        }
      },
      {
        "path": "/support_tickets/{ticketId}",
        "definition": {
          "entityName": "SupportTicket",
          "schema": {
            "$ref": "#/backend/entities/SupportTicket"
          },
          "description": "Stores support tickets submitted by users. Allows users to create tickets and admins to manage them."
        }
      },
      {
        "path": "/public_images/{imageId}",
        "definition": {
          "entityName": "PublicImage",
          "schema": {
            "$ref": "#/backend/entities/PublicImage"
          },
          "description": "Stores a copy of images that users have made public. This collection is optimized for public, read-only access."
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to securely manage user authentication and admin roles, ensuring authorization independence and supporting secure list operations (QAPs). We achieve this by separating user data and admin role definitions into distinct collections. The structure prioritizes simplicity and leverages path-based ownership for user data. Admin roles are determined by the *existence* of a document in a dedicated `/roles_admin/{uid}` collection, enabling simple presence checks in security rules without relying on complex data comparisons. This is more robust than storing the admin role within the user document itself. The path-based ownership structure `/users/{userId}` ensures secure `list` operations, as rules can easily restrict access based on the authenticated user ID. A global `notifications` collection is added for admins to broadcast messages. A `user_notifications` subcollection is added under each user to handle per-user read status, improving scalability and query efficiency. A `support_tickets` collection is added for users to submit issue reports. A `public_images` collection is added to store copies of user-generated images that are explicitly made public, allowing for efficient and secure public feed queries without exposing user-private data. An `admin_notifications` collection is added to log events for admin review, such as credit purchases."
  }
}
